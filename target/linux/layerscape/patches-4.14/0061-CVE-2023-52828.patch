--- a/kernel/bpf/core.c
+++ b/kernel/bpf/core.c
@@ -395,7 +395,11 @@ static __always_inline int bpf_tree_comp
 
 	if (val < symbol_start)
 		return -1;
-	if (val >= symbol_end)
+	/* Ensure that we detect return addresses as part of the program, when
+	 * the final instruction is a call for a program part of the stack
+	 * trace. Therefore, do val > symbol_end instead of val >= symbol_end.
+	 */
+	if (val > symbol_end)
 		return  1;
 
 	return 0;
