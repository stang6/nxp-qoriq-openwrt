--- a/drivers/net/tun.c
+++ b/drivers/net/tun.c
@@ -2144,8 +2144,10 @@ static int tun_set_iff(struct net *net,
 		if (!dev)
 			return -ENOMEM;
 		err = dev_get_valid_name(net, dev, name);
-		if (err < 0)
-			goto err_free_dev;
+		if (err < 0) {
+			free_netdev(dev);
+			return err;
+		}
 
 		dev_net_set(dev, net);
 		dev->rtnl_link_ops = &tun_link_ops;
