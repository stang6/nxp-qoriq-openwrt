--- a/fs/btrfs/ioctl.c
+++ b/fs/btrfs/ioctl.c
@@ -669,6 +669,9 @@ static int create_snapshot(struct btrfs_
 	int ret;
 	bool snapshot_force_cow = false;
 
+	if (btrfs_root_refs(&root->root_item) == 0)
+		return -ENOENT;
+
 	if (!test_bit(BTRFS_ROOT_REF_COWS, &root->state))
 		return -EINVAL;
 
